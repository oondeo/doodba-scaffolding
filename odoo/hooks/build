#!/bin/bash

echo "------ HOOK START - BUILD -------"
printenv

if [ "$DOCKER_TAG" == "latest" ]
then
    DOCKER_TAG=${LATEST_VERSION:-"12.0"}
fi
if [ "$DOCKER_TAG" == "8.0" ]
then
    rm -f custom/conf.d/queue.conf
fi
BUILD_ARGS=""
while IFS='=' read -r NAME VALUE ; do
    BUILD_ARGS="$BUILD_ARGS --build-arg $NAME=$VALUE"
done < <(env)
echo "BUILD_ARGS=$BUILD_ARGS"
docker build \
    --build-arg UID=1000 \
    --build-arg GID=1000 \
    --build-arg UMASK="000" \
    --build-arg AGGREGATE="true" \
    --build-arg INITIAL_LANG="es" \
    --build-arg PYTHONOPTIMIZE="2" \
    --build-arg CLEAN="true" \
    --build-arg COMPILE="true" \
    --build-arg ODOO_VERSION=$DOCKER_TAG \
    -t $IMAGE_NAME .

echo "------ HOOK END - BUILD -------"
